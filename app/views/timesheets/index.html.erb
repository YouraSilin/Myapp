<h3>Загрузить табель из XLSX</h3>
<%= form_with url: import_timesheets_path do |f|%>
  <div class="mb-3 row">
    <div class="col-sm-2 col-form-label">
      <%= f.label :archive, 'выбрать XLSX'%>
    </div>
    <div class="col-sm-10">
      <%= f.file_field :file, class: 'form-control' %>
    </div>
  </div>
  <%= f.submit 'Импорт файла', class: 'btn btn-primary' %>
<% end %>

<%= link_to 'Экспорт в XLSX', timesheets_path(format: :xlsx), class: "btn btn-primary mt-5 text-white text-decoration-none", style: "width: 8rem" %>

<%= link_to 'Добавить', new_timesheet_path, class: "btn btn-primary mt-5 text-white text-decoration-none", style: "width: 8rem" %>

<%= link_to "Очистить", timesheet_delete_all_path(@timesheets), class: "btn btn-primary mt-5 text-white text-decoration-none", style: "width: 8rem" , method: :delete %>

<form class="d-flex mt-5" role="search">
  <%= form_with(url: timesheets_path, method: :get, data: { turbo_frame: "timesheets"}) do |form| %>
    <%= form.text_field :query, class: "form-control me-2", type: "search", placeholder: "Поиск по табелям" %>
    <%= form.submit "Найти", class: "btn btn-outline-success ", style: "width: 8rem", type: "submit" %>
  <% end %>
</form>

<div class="">
<table class="table table-striped table-hover border mt-5 mb-10" style="font-size: 0.7rem;">
  
  <thead>
    <tr style="position:sticky">
      <th rowspan=2 scope="col" class="border"> </th>
      <th rowspan=2 scope="col" class="border">Код</th>
      <th rowspan=2 scope="col" class="border">таб№</th>
      <th rowspan=2 scope="col" class="border">офиц.</th>
      <th rowspan=2 scope="col" class="border">факт</th>
      <th rowspan=2 scope="col" class="border">№</th>
      <th rowspan=2 scope="col" class="border">фамилия И.О.</th>
      <th rowspan=2 scope="col" class="border">Должность</th>
      <th colspan=<%= $days_count %> scope="col" class="border">Дни</th>
      <th rowspan=2 scope="col" class="border">Явок</th>
      <th rowspan=2 scope="col" class="border">Часов</th>
      <th rowspan=2 scope="col" class="border">день</th>
      <th rowspan=2 scope="col" class="border">ночь</th>
      <th rowspan=2 scope="col" class="border">Итого:</th>
      <th rowspan=2 scope="col" class="border">Н</th>
      <th rowspan=2 scope="col" class="border">з\я</th>
      <th rowspan=2 scope="col" class="border">сп</th>
      <th rowspan=2 scope="col" class="border">б</th>
      <th rowspan=2 scope="col" class="border">от</th>
      <th rowspan=2 scope="col" class="border">а</th>
      <th rowspan=2 scope="col" class="border">и</th>
      <th rowspan=2 scope="col" class="border">оа</th>
    </tr>
    <tr>
      <% $days_count.times do |day_num| %>
        <td class="border"><%= day_num + 1 %></td>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @timesheets.each do |timesheet| %>
      <tr onclick="window.location.href='<%= edit_timesheet_path(timesheet) %>'" > 
        <td class="border"><%= timesheet.unit %></td>
        <td class="border"><%= timesheet.subdivision_code %></td>
        <td class="border"><%= timesheet.personnel_number %></td>
        <td class="border"><%= (timesheet.employment_official_date[0,10]) %></td> 
        <%#= Date.parse(timesheet.employment_official_date).strftime("%d.%m.%y")  %>
        <td class="border"><%= (timesheet.employment_fact_date[0,10]) %></td>
        <td class="border"><%= timesheet.id %></td>
        <td class="border"><div style="background:#<%= if timesheet.colour.length == 8 then timesheet.colour[2,7] else timesheet.colour end %>"><%= timesheet.full_name %></div></td>
        <td class="border"><%= timesheet.position %></td>
        <% timesheet.worked_hours_per_shift.each do |worked_hour| %>
          <td class="border"><%= worked_hour %></td>
        <% end %>
        <td class="border"><%= timesheet.worked_shifts_total %></td>
        <td class="border"><%= timesheet.worked_hours_total %></td>
        <td class="border"><%= timesheet.worked_hours_per_day %></td>
        <td class="border"><%= timesheet.worked_hours_per_night %></td>
        <td class="border"><%= timesheet.check_formula %></td>
        <td class="border"><%= timesheet.absences_total %></td>
        <td class="border"><%= timesheet.absences_by_request %></td>
        <td class="border"><%= timesheet.absences_by_certificate %></td>
        <td class="border"><%= timesheet.absences_by_sick_leave %></td>
        <td class="border"><%= timesheet.vacation_days_total %></td>
        <td class="border"><%= timesheet.absences_by_permission %></td>
        <td class="border"><%= timesheet.absences_with_working_out %></td>
        <td class="border"><%= timesheet.absences_by_permission_vacation %></td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>